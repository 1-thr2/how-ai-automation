# 🧠 실패 패턴 학습 시스템 가이드

## 🎯 **안전한 주간 리뷰 프로세스**

### **1. 현재 상황**
- ✅ **Supabase에 모든 요청/결과 자동 저장 중**
- ✅ **성공/실패, 에러 메시지, 처리 시간 등 수집**
- ✅ **즉시 실행 가능한 데이터 분석 환경**

### **2. 주간 리뷰 프로세스**

```bash
# 매주 금요일 오후 실행
npm run review:weekly
```

#### 🔄 **자동 처리되는 단계들**
1. **데이터 추출**: 지난 7일간 Supabase 데이터
2. **패턴 분석**: Claude가 실패 패턴 식별
3. **리포트 생성**: JSON + 마크다운 요약 파일
4. **저장**: `data/weekly-reviews/review-YYYY-MM-DD.md`

#### 👁️ **사람이 검토해야 하는 부분들**

**🚨 검토 체크리스트**:
- [ ] **패턴이 실제 문제인가?** (3회 이상 발생 + 향후 재발 가능성)
- [ ] **대안이 현실적인가?** (초보자도 실행 가능한 수준)
- [ ] **기존 패턴과 중복 없나?** (중복 방지)
- [ ] **심각도가 적절한가?** (critical/warning/info)

### **3. 승인된 패턴 반영**

#### **Step 1**: 패턴 추가
```typescript
// src/lib/agents/failure-patterns.ts에 추가
export const SMART_FAILURE_PATTERNS: FailurePattern[] = [
  // ... 기존 패턴들
  {
    id: 'new_pattern_2025_01_03', // 검토일 기준
    pattern: {
      contexts: ['검토에서 승인된 컨텍스트'],
      actions: ['검토에서 승인된 액션'],
      tools: ['검토에서 승인된 도구'],
      intent: '검토에서 승인된 의도'
    },
    reason: '검토에서 승인된 실패 이유',
    alternatives: ['검토에서 승인된 대안들'],
    severity: 'warning', // 검토에서 결정된 심각도
    lastUpdated: '2025-01-03T10:00:00Z',
    examples: ['실제 사용자 입력 예시들'],
    confidence: 0.85 // 검토에서 결정된 신뢰도
  }
];
```

#### **Step 2**: Git 커밋
```bash
git add src/lib/agents/failure-patterns.ts
git commit -m "✨ 주간 리뷰: 새 실패 패턴 추가 (2025-01-03)

- 추가된 패턴: new_pattern_2025_01_03
- 근거: 7일간 5회 발생, 재발 가능성 높음
- 검토자: [이름]
"
```

#### **Step 3**: 배포
```bash
# 자동 배포 환경이면 Git push만
git push origin main

# 수동 배포 환경이면
npm run build
# 서버 재시작
```

## 📊 **리뷰 파일 예시**

### **data/weekly-reviews/review-2025-01-03.md**
```markdown
# 주간 실패 패턴 리뷰

**기간**: 2024.12.27 ~ 2025.01.03

## 📊 요약 통계
- **총 요청**: 147건
- **실패율**: 12.2%

## 🚨 주요 실패 패턴

### kakao_messaging (8건)
**예시 사용자 입력**:
- "회사 공지사항을 카카오톡으로 자동 전송하고 싶어요"
- "카톡으로 일정 알림 보내기"

### web_scraping (5건)
**예시 사용자 입력**:
- "네이버 뉴스 크롤링해서 요약"
- "쇼핑몰 가격 정보 수집"

## 🧠 Claude 제안 패턴

### 1. shopping_price_monitoring
- **심각도**: warning
- **신뢰도**: 75%
- **이유**: 대부분 쇼핑몰이 크롤링 금지
- **대안**: 가격비교 API, RSS 피드 활용
```

## 🛡️ **안전성 보장 장치들**

### **1. 단계별 검증**
```
📊 데이터 추출 → 🧠 AI 분석 → 👁️ 사람 검토 → ✅ 승인 → 🚀 반영
```

### **2. 되돌리기 가능**
- **Git 이력**: 모든 변경사항 추적
- **점진적 반영**: 한 번에 대량 변경 X
- **A/B 테스트**: 새 패턴 효과 검증

### **3. 품질 관리**
- **최소 발생 빈도**: 3회 이상
- **재발 가능성**: 향후에도 발생할 패턴만
- **대안 검증**: 제안된 대안이 실제 작동하는지 확인

## 🎯 **이 방식의 장점**

### **✅ 무지성 자동화 방지**
- AI가 제안만 하고, 사람이 최종 결정
- 잘못된 패턴이 시스템에 박힐 위험 차단

### **✅ 점진적 개선**
- 주간 단위로 천천히 개선
- 급작스런 변화로 인한 서비스 장애 방지

### **✅ 추적 가능성**
- 모든 변경사항이 Git에 기록
- 언제든 이전 상태로 되돌리기 가능

### **✅ 확장성**
- 패턴 DB가 자연스럽게 성장
- 사용자 피드백 반영 가능

## 🚀 **실행 계획**

### **Week 1**: 시스템 검증
```bash
# 테스트 실행
npm run review:weekly

# 생성된 파일 확인
cat data/weekly-reviews/review-$(date +%Y-%m-%d).md
```

### **Week 2**: 첫 리얼 리뷰
- 생성된 리포트 검토
- 1-2개 패턴만 선별적 승인
- 효과 모니터링

### **Week 3+**: 정례화
- 매주 금요일 오후 리뷰
- 패턴 DB 점진적 성장
- 시스템 품질 지속 개선

---

## 💡 **핵심 포인트**

1. **자동화는 도구일 뿐, 결정은 사람이**
2. **작고 안전한 단계로 점진적 개선**
3. **모든 변경사항을 추적 가능하게**
4. **효과를 측정하고 피드백 반영**