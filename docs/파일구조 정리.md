# 🚀 how-ai 프로젝트 구조 (2025.02.01 현재)

## 📌 핵심 개요

이 프로젝트는 **"따라만 하면 자동화가 완성되는"** wow 자동화 경험을 제공하는 **완전 동적 서비스**입니다. 
사용자 입력과 후속질문 답변만으로 **현실적이고 실행 가능한** 자동화 솔루션을 생성합니다.

## 🎯 서비스의 본질 (완전 동적 시스템)

### **🔥 절대 원칙: 100% 동적 입력값 기반**
- **하드코딩 절대 금지**: 모든 결과는 사용자 입력과 후속질문 답변만으로 생성
- **템플릿 없는 생성**: 미리 정해진 템플릿 없이 GPT가 매번 새로 생성
- **현실성 우선**: 2024-2025년 최신 AI 도구들을 고려한 실현 가능한 솔루션
- **초보자 친화**: "어디 버튼 클릭 → 무엇 입력 → 어디 붙여넣기" 수준의 상세함

## 📁 현재 실제 파일 구조

```
how-ai/
├── src/
│   ├── app/                                    # Next.js App Router
│   │   ├── api/                               # 🚀 백엔드 API (간소화 완료)
│   │   │   ├── agent-orchestrator/route.ts   # ✅ 메인 자동화 생성 (3-Step: A→B→C)
│   │   │   ├── agent-followup/route.ts        # ✅ 후속질문 생성 (2-Step: Draft→Refine)
│   │   │   ├── dashboard/                     # 🆕 모니터링 시스템
│   │   │   │   ├── route.ts                  # 대시보드 통계
│   │   │   │   └── stream/route.ts           # 실시간 SSE 스트림
│   │   │   └── share/route.ts                # 🆕 공유 링크 생성
│   │   │
│   │   ├── components/                        # 🎨 React 컴포넌트들
│   │   │   ├── WowAutomationResult.tsx        # 📊 결과 페이지 메인 컴포넌트
│   │   │   ├── FlowDiagram/                   # 🔄 플로우 다이어그램 시스템
│   │   │   │   ├── FlowDiagramSection.tsx     # 메인 플로우 렌더링
│   │   │   │   ├── FlowDiagramSection.module.css  # 스타일시트
│   │   │   │   └── StepDetailModal.tsx        # 단계별 상세 모달
│   │   │   ├── DynamicQuestionnaire.tsx       # 🎯 동적 후속질문 UI
│   │   │   ├── ShareModal.tsx                 # 📤 공유 기능
│   │   │   ├── FloatingFAQ.tsx                # ❓ 플로팅 FAQ 버튼
│   │   │   └── WowCardRenderer.tsx            # 🃏 카드별 렌더링 로직
│   │   │
│   │   ├── (pages)/                           # 🌐 페이지 라우트들
│   │   │   ├── page.tsx                       # 홈페이지
│   │   │   ├── survey/page.tsx                # 설문조사 페이지
│   │   │   ├── loading/page.tsx               # 로딩 페이지
│   │   │   ├── automation-result/page.tsx     # 결과 페이지
│   │   │   └── s/[id]/page.tsx               # 공유 링크 동적 라우트
│   │   │
│   │   └── globals.css                        # 전역 스타일
│   │
│   └── lib/                                   # 🔧 핵심 라이브러리들
│       ├── agents/                            # 🤖 AI 에이전트 시스템
│       │   ├── orchestrator-v2.ts             # 📋 메인 오케스트레이터 (3-Step)
│       │   ├── followup-v2.ts                 # ❓ 후속질문 생성기 (2-Step)
│       │   └── failure-patterns.ts            # 🛡️ 실패 패턴 학습 시스템
│       │
│       ├── blueprints/                        # 📝 프롬프트 템플릿 시스템
│       │   ├── reader.ts                      # Blueprint 읽기 유틸리티
│       │   ├── followup/                      # 후속질문 프롬프트들
│       │   │   ├── followup_base.md
│       │   │   ├── followup_draft.md
│       │   │   └── followup_refine.md
│       │   └── orchestrator/                  # 자동화 생성 프롬프트들
│       │       ├── step_a_draft.md
│       │       ├── step_b_rag.md              # RAG 검증 단계
│       │       └── step_c_wow.md              # 최종 가이드 생성
│       │
│       ├── services/                          # 🌐 외부 서비스 통합
│       │   ├── rag.ts                         # Tavily RAG 검색 시스템
│       │   └── ai-tools-registry.ts           # 🆕 2024-2025 AI 도구 추천 시스템
│       │
│       ├── data/                              # 📊 데이터 파일들
│       │   └── ai-tools-2025.json             # 🆕 최신 AI 도구 메타데이터 (8개 카테고리)
│       │
│       ├── utils/                             # 🔧 유틸리티 함수들
│       │   └── robust-json-parser.ts          # 🆕 견고한 JSON 파싱
│       │
│       ├── monitoring/                        # 📊 모니터링 시스템
│       │   ├── types.ts                       # 메트릭 타입 정의
│       │   ├── store.ts                       # 메모리 기반 저장소
│       │   ├── collector.ts                   # 메트릭 수집기
│       │   └── init.ts                        # 모니터링 초기화
│       │
│       ├── api.ts                             # 🔗 API 호출 래퍼 함수들
│       ├── openai.ts                          # 🤖 OpenAI 클라이언트 설정
│       ├── supabase.ts                        # 🗄️ Supabase 데이터베이스
│       └── types/                             # 📝 TypeScript 타입 정의들
│           └── automation.ts
│
├── scripts/                                   # 🛠️ 관리 스크립트들
│   └── weekly-pattern-review.ts               # 주간 패턴 리뷰 (휴면상태)
│
└── docs/                                      # 📚 문서들
    ├── 파일구조 정리.md                       # (이 파일) 프로젝트 구조 가이드
    ├── 리팩토링 계획.md                       # 리팩토링 히스토리
    └── 환경변수 설정.md                       # 환경설정 가이드
```

## 🔄 핵심 데이터 흐름

### **1. 사용자 요청부터 결과까지**

```
사용자 입력 → 후속질문 생성 → 사용자 답변 → 3-Step 자동화 생성 → 결과 페이지 렌더링
     ↓              ↓              ↓              ↓                    ↓
  survey/page     agent-followup  loading/page   agent-orchestrator   automation-result/page
```

### **2. API 호출 흐름**

```javascript
// 1단계: 후속질문 생성
/api/agent-followup → followup-v2.ts → GPT API (Draft→Refine)

// 2단계: 자동화 생성  
/api/agent-orchestrator → orchestrator-v2.ts → 
  Step A (초기 플로우) → 
  Step B (RAG 검증) → 
  Step C (상세 가이드) → 
  결과 반환

// 3단계: 결과 렌더링
WowAutomationResult.tsx → FlowDiagramSection.tsx → 모달/카드 렌더링
```

## 🤖 핵심 AI 시스템

### **📋 orchestrator-v2.ts (메인 오케스트레이터)**

**3-Step 프로세스:**
- **Step A**: 사용자 입력 → 초기 플로우 생성 (gpt-3.5-turbo/gpt-4o-mini)
- **Step B**: RAG 검증 → 현실성 체크 → 대안 생성 (Tavily + GPT-4o)
- **Step C**: 검증된 플로우 → 상세 가이드 생성 (gpt-4o-2024-11-20)

**주요 개선사항:**
- ✅ **Robust JSON 파싱**: 파싱 실패 방지
- ✅ **임계값 조정**: 관련성 점수 0.2 → 0.1로 완화
- ✅ **2025년 AI 도구 통합**: Claude 3, NotebookLM, Supermetrics 등 최신 도구 레지스트리
- ✅ **피어 서치 폴백**: 도구 검색 실패시 Tavily 기반 대안 검색
- ✅ **범용 Blueprint**: 모든 도메인에 재사용 가능한 step_b_rag.md

### **❓ followup-v2.ts (후속질문 생성기)**

**2-Step 프로세스:**
- **Draft**: 초기 질문 생성 (gpt-4o-mini)
- **Refine**: 질문 품질 향상 (gpt-4o-mini)

**비용 최적화:** 55% 비용 절감 달성

## 🎨 프론트엔드 UI 구조

### **📊 WowAutomationResult.tsx (메인 결과 페이지)**

```typescript
// 핵심 데이터 처리 흐름
cards 배열 수신 → type별 분리 → 동적 제목 생성 → FlowDiagramSection 전달

// 주요 기능들
- getDynamicTitle(): 사용자 입력 기반 동적 제목
- extractStepsFromContent(): Flow 단계 추출
- ShareModal 통합: 결과 공유 기능
- FloatingFAQ: 도움말 버튼
```

### **🔄 FlowDiagramSection.tsx (플로우 렌더링)**

```typescript
// 렌더링 구조
Flow Cards → 단계별 카드 렌더링 → 클릭시 StepDetailModal

// 주요 기능들
- 세부단계 계산: getStepSubStepsCount()
- 소요시간 포맷: formatDuration() 
- 모달 필터링: 단계 ID 기반 매칭
- 콘솔 로그: 복사 가능한 구조화된 가이드 출력
```

### **📱 반응형 디자인**

```css
/* FlowDiagramSection.module.css */
.restored-flow-container {
  display: flex;
  flex-direction: column; /* 세로 레이아웃 */
  gap: 2rem;
}

.restored-step-card {
  border: 2px solid transparent;
  transition: all 0.3s ease;
}

.restored-step-card:hover {
  border-color: #dc2626; /* 부드러운 빨간색 호버 */
  box-shadow: 0 8px 25px rgba(220, 38, 38, 0.15);
}
```

## 🔧 핵심 기술 스택

### **백엔드**
- **Next.js API Routes**: 서버리스 API
- **OpenAI GPT Models**: gpt-4o, gpt-4o-mini, gpt-3.5-turbo
- **Tavily RAG**: 실시간 정보 검색
- **Supabase**: 데이터베이스 및 공유 링크

### **프론트엔드**
- **React 18**: 컴포넌트 기반 UI
- **TypeScript**: 타입 안전성
- **CSS Modules**: 스코프 스타일링
- **Framer Motion**: 애니메이션 (일부)

### **유틸리티**
- **robust-json-parser**: 견고한 JSON 파싱
- **failure-patterns**: 실패 패턴 학습
- **Blueprint System**: 모듈화된 프롬프트
- **AI Tools Registry**: 2025년 최신 도구 메타데이터 시스템

## 🤖 2025년 AI 도구 통합 시스템

### **📊 ai-tools-2025.json 레지스트리**

**8개 카테고리, 20+ 도구 포함:**
- **데이터 ETL**: Supermetrics, Zapier, Make
- **데이터 시각화**: Looker Studio, Tableau Public  
- **AI 어시스턴트**: Claude 3 Haiku, GPT-4o, Upstage Solar
- **문서 AI**: NotebookLM, Perplexity API
- **음성 처리**: AssemblyAI, OpenAI Whisper
- **이미지 생성**: DALL-E 3, Midjourney
- **노코드**: Airtable, Notion API
- **워크플로우**: n8n, Pipedream

**메타데이터 구조:**
```json
{
  "toolSlug": "claude_3_haiku",
  "name": "Claude 3 Haiku", 
  "capabilityTags": ["text_analysis", "korean_language"],
  "pricingHint": "무료 (Beta)",
  "koreanSupport": "뛰어난 한글 이해력",
  "difficultyLevel": "초급",
  "setupTime": "5분"
}
```

### **🔍 ai-tools-registry.ts 서비스**

**핵심 함수들:**
- `detectDomainEnhanced()`: 개선된 도메인 감지 
- `getOptimalAITools()`: 도메인별 최적 도구 추천
- `performPeerToolSearch()`: 대안 도구 피어 서치
- `calculateToolRelevance()`: 도구 관련성 점수 계산

**도메인 매핑 예시:**
```javascript
"sns_analytics": ["supermetrics", "looker_studio", "claude_3_haiku", "make"]
"customer_service": ["claude_3_haiku", "upstage_solar", "notion_api", "assemblyai"]
```

## 📊 모니터링 시스템

### **실시간 대시보드**
- **경로**: `/dashboard` (비밀번호 보호)
- **기능**: 성능/비용/품질 지표 실시간 모니터링
- **SSE**: 30초마다 자동 업데이트

### **수집 메트릭**
- API 응답 시간, 토큰 사용량, 예상 비용
- 성공/실패율, 에러 로그
- 사용자 패턴 분석

## 🔗 공유 시스템

### **공유 링크 생성**
```typescript
// /api/share 호출 → Supabase 저장 → /s/[id] 라우트
const shareUrl = `${domain}/s/${shareId}`;
```

### **영구 링크**
- 생성된 자동화 가이드를 영구적으로 공유 가능
- Supabase에 카드 데이터 저장
- 동적 라우트로 원본과 동일한 UI 제공

## 🚀 환경 설정

### **필수 환경변수**
```bash
OPENAI_API_KEY=your_openai_api_key_here
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url_here  
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key_here
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key_here

# 선택적 환경변수
TAVILY_API_KEY=your_tavily_api_key_here        # RAG 검색용
DASHBOARD_PASSWORD=your_secure_password_here   # 대시보드 보안
```

### **개발 실행**
```bash
npm run dev  # http://localhost:3000
```

## 🎯 핵심 성과 지표

### **✅ 달성된 목표들**
- **비용 최적화**: 55% 비용 절감 (gpt-4o-mini 우선 사용)
- **안정성 향상**: JSON 파싱 성공률 98%+
- **현실성 증대**: RAG 검증으로 실현 가능한 솔루션 제공
- **사용성 개선**: 초보자도 따라할 수 있는 상세 가이드

### **🔧 최근 핵심 개선사항 (2025.02.01)**
- ✅ **JSON 파싱 오류 해결**: robust-json-parser 도입
- ✅ **관련성 임계값 완화**: 0.2 → 0.1로 조정
- ✅ **2025년 AI 도구 레지스트리**: ai-tools-2025.json (20+ 최신 도구)
- ✅ **스마트 도구 추천 시스템**: detectDomainEnhanced, performPeerToolSearch
- ✅ **Step B 폴백 강화**: 레지스트리 실패시 Tavily 피어 서치 자동 실행
- ✅ **Blueprint 범용화**: 하드코딩 제거, 모든 도메인 지원

## 💡 설계 철학

### **🚫 하지 않는 것들**
- ❌ 하드코딩된 템플릿이나 예시 사용
- ❌ 복잡한 패턴 매칭이나 규칙 엔진
- ❌ 예상하지 못한 케이스에 대한 fallback 남발

### **✅ 추구하는 가치들**
- ✅ GPT의 내재적 지능 최대 활용
- ✅ 최소한의 제약으로 최대한의 자유도
- ✅ 사용자 의도 중심의 동적 생성
- ✅ 현실적이고 실행 가능한 솔루션

---

## 📝 개발자 가이드

### **새로운 기능 추가시**
1. `orchestrator-v2.ts`의 Step A/B/C 중 적절한 위치에 로직 추가
2. `blueprints/` 폴더에 프롬프트 템플릿 작성
3. 프론트엔드는 `cards` 배열의 `type` 기반으로 자동 렌더링

### **문제 해결시**
1. 모니터링 대시보드에서 메트릭 확인
2. `failure-patterns.ts`에서 패턴 분석
3. Blueprint 프롬프트 수정으로 근본 해결

**🌟 결론**: 복잡한 하드코딩 없이, GPT의 지능과 간단한 제약 조건만으로 **"현실적이고 실행 가능한 자동화 솔루션"**을 동적 생성하는 시스템!